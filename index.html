<!DOCTYPE html>
<html>

<head>
    <script type="text/json"
        src="https://cdn.jsdelivr.net/npm/@1inch/limit-order-protocol@1.3.0/abi/LimitOrderProtocol.json"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.3.6/dist/web3.min.js" type="text/javascript"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js" type="application/javascript"></script>

    <script async>
        $(() => {
            let signer;
            // Disable 'checkAcct' button initially
            $('#checkAcct').prop('disabled', true);

            $('#connect-wallet').on('click', async function (e) {
                e.preventDefault();

                window.ethereum.enable().then(
                    provider = new ethers.providers.Web3Provider(window.ethereum));
                signer = provider.getSigner();

                console.log(signer.getAddress());

                if (await signer.getAddress() != null && await signer.getAddress() != "") {
                    $('#connect-wallet').text(await signer.getAddress());

                    // Enable 'checkAcct' button after successful connection
                    $('#checkAcct').prop('disabled', false);
                }
            })

            $('#checkAcct').on('click', async function (e) {
                e.preventDefault();

                const usrAddress = await signer.getAddress();

                const BNBPoolFactory = "0xD41B24bbA51fAc0E4827b6F94C0D6DDeB183cD64";
                const ETHPoolFactory = "0xbAF9A5d4b0052359326A6CDAb54BABAa3a3A9643";

                const ABI = [{ "inputs": [{ "internalType": "address", "name": "_poolOwner", "type": "address" }, { "internalType": "contract IMooniswapDeployer", "name": "_mooniswapDeployer", "type": "address" }, { "internalType": "address", "name": "_governanceMothership", "type": "address" }], "stateMutability": "nonpayable", "type": "constructor" }, { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "user", "type": "address" }, { "indexed": false, "internalType": "uint256", "name": "decayPeriod", "type": "uint256" }, { "indexed": false, "internalType": "bool", "name": "isDefault", "type": "bool" }, { "indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "DefaultDecayPeriodVoteUpdate", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "user", "type": "address" }, { "indexed": false, "internalType": "uint256", "name": "fee", "type": "uint256" }, { "indexed": false, "internalType": "bool", "name": "isDefault", "type": "bool" }, { "indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "DefaultFeeVoteUpdate", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "user", "type": "address" }, { "indexed": false, "internalType": "uint256", "name": "slippageFee", "type": "uint256" }, { "indexed": false, "internalType": "bool", "name": "isDefault", "type": "bool" }, { "indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "DefaultSlippageFeeVoteUpdate", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "contract Mooniswap", "name": "mooniswap", "type": "address" }, { "indexed": true, "internalType": "contract IERC20", "name": "token1", "type": "address" }, { "indexed": true, "internalType": "contract IERC20", "name": "token2", "type": "address" }], "name": "Deployed", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "internalType": "address", "name": "feeCollector", "type": "address" }], "name": "FeeCollectorUpdate", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "user", "type": "address" }, { "indexed": false, "internalType": "uint256", "name": "governanceShare", "type": "uint256" }, { "indexed": false, "internalType": "bool", "name": "isDefault", "type": "bool" }, { "indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "GovernanceShareVoteUpdate", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "internalType": "address", "name": "governanceWallet", "type": "address" }], "name": "GovernanceWalletUpdate", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "previousOwner", "type": "address" }, { "indexed": true, "internalType": "address", "name": "newOwner", "type": "address" }], "name": "OwnershipTransferred", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "internalType": "address", "name": "account", "type": "address" }], "name": "Paused", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "user", "type": "address" }, { "indexed": false, "internalType": "uint256", "name": "referralShare", "type": "uint256" }, { "indexed": false, "internalType": "bool", "name": "isDefault", "type": "bool" }, { "indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "ReferralShareVoteUpdate", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "internalType": "address", "name": "account", "type": "address" }], "name": "Unpaused", "type": "event" }, { "inputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "name": "allPools", "outputs": [{ "internalType": "contract Mooniswap", "name": "", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "account", "type": "address" }], "name": "balanceOf", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "defaultDecayPeriod", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "vote", "type": "uint256" }], "name": "defaultDecayPeriodVote", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "user", "type": "address" }], "name": "defaultDecayPeriodVotes", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "defaultFee", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "vote", "type": "uint256" }], "name": "defaultFeeVote", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "user", "type": "address" }], "name": "defaultFeeVotes", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "defaultSlippageFee", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "vote", "type": "uint256" }], "name": "defaultSlippageFeeVote", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "user", "type": "address" }], "name": "defaultSlippageFeeVotes", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "defaults", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }, { "internalType": "uint256", "name": "", "type": "uint256" }, { "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "contract IERC20", "name": "tokenA", "type": "address" }, { "internalType": "contract IERC20", "name": "tokenB", "type": "address" }], "name": "deploy", "outputs": [{ "internalType": "contract Mooniswap", "name": "pool", "type": "address" }], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "discardDefaultDecayPeriodVote", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "discardDefaultFeeVote", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "discardDefaultSlippageFeeVote", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "discardGovernanceShareVote", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "discardReferralShareVote", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "feeCollector", "outputs": [{ "internalType": "address", "name": "", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getAllPools", "outputs": [{ "internalType": "contract Mooniswap[]", "name": "", "type": "address[]" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "governanceShare", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "vote", "type": "uint256" }], "name": "governanceShareVote", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "user", "type": "address" }], "name": "governanceShareVotes", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "governanceWallet", "outputs": [{ "internalType": "address", "name": "", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "isActive", "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "", "type": "address" }], "name": "isFeeCollector", "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "contract Mooniswap", "name": "", "type": "address" }], "name": "isPool", "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "mooniswapDeployer", "outputs": [{ "internalType": "contract IMooniswapDeployer", "name": "", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "mothership", "outputs": [{ "internalType": "address", "name": "", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "account", "type": "address" }, { "internalType": "uint256", "name": "newBalance", "type": "uint256" }], "name": "notifyStakeChanged", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address[]", "name": "accounts", "type": "address[]" }, { "internalType": "uint256[]", "name": "newBalances", "type": "uint256[]" }], "name": "notifyStakesChanged", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "owner", "outputs": [{ "internalType": "address", "name": "", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "paused", "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "poolOwner", "outputs": [{ "internalType": "address", "name": "", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "contract IERC20", "name": "tokenA", "type": "address" }, { "internalType": "contract IERC20", "name": "tokenB", "type": "address" }], "name": "pools", "outputs": [{ "internalType": "contract Mooniswap", "name": "pool", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "referralShare", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "vote", "type": "uint256" }], "name": "referralShareVote", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "user", "type": "address" }], "name": "referralShareVotes", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "renounceOwnership", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "newFeeCollector", "type": "address" }], "name": "setFeeCollector", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "newGovernanceWallet", "type": "address" }], "name": "setGovernanceWallet", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "shareParameters", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }, { "internalType": "uint256", "name": "", "type": "uint256" }, { "internalType": "address", "name": "", "type": "address" }, { "internalType": "address", "name": "", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "shutdown", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "contract IERC20", "name": "tokenA", "type": "address" }, { "internalType": "contract IERC20", "name": "tokenB", "type": "address" }], "name": "sortTokens", "outputs": [{ "internalType": "contract IERC20", "name": "", "type": "address" }, { "internalType": "contract IERC20", "name": "", "type": "address" }], "stateMutability": "pure", "type": "function" }, { "inputs": [], "name": "totalSupply", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "newOwner", "type": "address" }], "name": "transferOwnership", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "virtualDefaultDecayPeriod", "outputs": [{ "internalType": "uint104", "name": "", "type": "uint104" }, { "internalType": "uint104", "name": "", "type": "uint104" }, { "internalType": "uint48", "name": "", "type": "uint48" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "virtualDefaultFee", "outputs": [{ "internalType": "uint104", "name": "", "type": "uint104" }, { "internalType": "uint104", "name": "", "type": "uint104" }, { "internalType": "uint48", "name": "", "type": "uint48" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "virtualDefaultSlippageFee", "outputs": [{ "internalType": "uint104", "name": "", "type": "uint104" }, { "internalType": "uint104", "name": "", "type": "uint104" }, { "internalType": "uint48", "name": "", "type": "uint48" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "virtualGovernanceShare", "outputs": [{ "internalType": "uint104", "name": "", "type": "uint104" }, { "internalType": "uint104", "name": "", "type": "uint104" }, { "internalType": "uint48", "name": "", "type": "uint48" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "virtualReferralShare", "outputs": [{ "internalType": "uint104", "name": "", "type": "uint104" }, { "internalType": "uint104", "name": "", "type": "uint104" }, { "internalType": "uint48", "name": "", "type": "uint48" }], "stateMutability": "view", "type": "function" }];

                // the abi above is the ABI for both factories
                const BNBProvider = new ethers.providers.JsonRpcProvider('https://bsc-dataseed1.binance.org');
                const ETHProvider = new ethers.providers.JsonRpcProvider('https://cloudflare-eth.com');

                const bnbContract = new ethers.Contract(BNBPoolFactory, ABI, BNBProvider);
                const ethContract = new ethers.Contract(ETHPoolFactory, ABI, ETHProvider);

                const poolABI = [{ "inputs": [{ "internalType": "contract IERC20", "name": "_token0", "type": "address" }, { "internalType": "contract IERC20", "name": "_token1", "type": "address" }, { "internalType": "string", "name": "name", "type": "string" }, { "internalType": "string", "name": "symbol", "type": "string" }, { "internalType": "contract IMooniswapFactoryGovernance", "name": "_mooniswapFactoryGovernance", "type": "address" }], "stateMutability": "nonpayable", "type": "constructor" }, { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "owner", "type": "address" }, { "indexed": true, "internalType": "address", "name": "spender", "type": "address" }, { "indexed": false, "internalType": "uint256", "name": "value", "type": "uint256" }], "name": "Approval", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "user", "type": "address" }, { "indexed": false, "internalType": "uint256", "name": "decayPeriod", "type": "uint256" }, { "indexed": false, "internalType": "bool", "name": "isDefault", "type": "bool" }, { "indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "DecayPeriodVoteUpdate", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "sender", "type": "address" }, { "indexed": true, "internalType": "address", "name": "receiver", "type": "address" }, { "indexed": false, "internalType": "uint256", "name": "share", "type": "uint256" }, { "indexed": false, "internalType": "uint256", "name": "token0Amount", "type": "uint256" }, { "indexed": false, "internalType": "uint256", "name": "token1Amount", "type": "uint256" }], "name": "Deposited", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "internalType": "string", "name": "reason", "type": "string" }], "name": "Error", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "user", "type": "address" }, { "indexed": false, "internalType": "uint256", "name": "fee", "type": "uint256" }, { "indexed": false, "internalType": "bool", "name": "isDefault", "type": "bool" }, { "indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "FeeVoteUpdate", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "previousOwner", "type": "address" }, { "indexed": true, "internalType": "address", "name": "newOwner", "type": "address" }], "name": "OwnershipTransferred", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "user", "type": "address" }, { "indexed": false, "internalType": "uint256", "name": "slippageFee", "type": "uint256" }, { "indexed": false, "internalType": "bool", "name": "isDefault", "type": "bool" }, { "indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "SlippageFeeVoteUpdate", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "sender", "type": "address" }, { "indexed": true, "internalType": "address", "name": "receiver", "type": "address" }, { "indexed": true, "internalType": "address", "name": "srcToken", "type": "address" }, { "indexed": false, "internalType": "address", "name": "dstToken", "type": "address" }, { "indexed": false, "internalType": "uint256", "name": "amount", "type": "uint256" }, { "indexed": false, "internalType": "uint256", "name": "result", "type": "uint256" }, { "indexed": false, "internalType": "uint256", "name": "srcAdditionBalance", "type": "uint256" }, { "indexed": false, "internalType": "uint256", "name": "dstRemovalBalance", "type": "uint256" }, { "indexed": false, "internalType": "address", "name": "referral", "type": "address" }], "name": "Swapped", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "internalType": "uint256", "name": "srcBalance", "type": "uint256" }, { "indexed": false, "internalType": "uint256", "name": "dstBalance", "type": "uint256" }, { "indexed": false, "internalType": "uint256", "name": "fee", "type": "uint256" }, { "indexed": false, "internalType": "uint256", "name": "slippageFee", "type": "uint256" }, { "indexed": false, "internalType": "uint256", "name": "referralShare", "type": "uint256" }, { "indexed": false, "internalType": "uint256", "name": "governanceShare", "type": "uint256" }], "name": "Sync", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "from", "type": "address" }, { "indexed": true, "internalType": "address", "name": "to", "type": "address" }, { "indexed": false, "internalType": "uint256", "name": "value", "type": "uint256" }], "name": "Transfer", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "sender", "type": "address" }, { "indexed": true, "internalType": "address", "name": "receiver", "type": "address" }, { "indexed": false, "internalType": "uint256", "name": "share", "type": "uint256" }, { "indexed": false, "internalType": "uint256", "name": "token0Amount", "type": "uint256" }, { "indexed": false, "internalType": "uint256", "name": "token1Amount", "type": "uint256" }], "name": "Withdrawn", "type": "event" }, { "inputs": [{ "internalType": "address", "name": "owner", "type": "address" }, { "internalType": "address", "name": "spender", "type": "address" }], "name": "allowance", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "spender", "type": "address" }, { "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "approve", "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "account", "type": "address" }], "name": "balanceOf", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "decayPeriod", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "vote", "type": "uint256" }], "name": "decayPeriodVote", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "user", "type": "address" }], "name": "decayPeriodVotes", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "decimals", "outputs": [{ "internalType": "uint8", "name": "", "type": "uint8" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "spender", "type": "address" }, { "internalType": "uint256", "name": "subtractedValue", "type": "uint256" }], "name": "decreaseAllowance", "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "uint256[2]", "name": "maxAmounts", "type": "uint256[2]" }, { "internalType": "uint256[2]", "name": "minAmounts", "type": "uint256[2]" }], "name": "deposit", "outputs": [{ "internalType": "uint256", "name": "fairSupply", "type": "uint256" }, { "internalType": "uint256[2]", "name": "receivedAmounts", "type": "uint256[2]" }], "stateMutability": "payable", "type": "function" }, { "inputs": [{ "internalType": "uint256[2]", "name": "maxAmounts", "type": "uint256[2]" }, { "internalType": "uint256[2]", "name": "minAmounts", "type": "uint256[2]" }, { "internalType": "address", "name": "target", "type": "address" }], "name": "depositFor", "outputs": [{ "internalType": "uint256", "name": "fairSupply", "type": "uint256" }, { "internalType": "uint256[2]", "name": "receivedAmounts", "type": "uint256[2]" }], "stateMutability": "payable", "type": "function" }, { "inputs": [], "name": "discardDecayPeriodVote", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "discardFeeVote", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "discardSlippageFeeVote", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "fee", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "vote", "type": "uint256" }], "name": "feeVote", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "user", "type": "address" }], "name": "feeVotes", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "contract IERC20", "name": "token", "type": "address" }], "name": "getBalanceForAddition", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "contract IERC20", "name": "token", "type": "address" }], "name": "getBalanceForRemoval", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "contract IERC20", "name": "src", "type": "address" }, { "internalType": "contract IERC20", "name": "dst", "type": "address" }, { "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "getReturn", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getTokens", "outputs": [{ "internalType": "contract IERC20[]", "name": "tokens", "type": "address[]" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "spender", "type": "address" }, { "internalType": "uint256", "name": "addedValue", "type": "uint256" }], "name": "increaseAllowance", "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "mooniswapFactoryGovernance", "outputs": [{ "internalType": "contract IMooniswapFactoryGovernance", "name": "", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "name", "outputs": [{ "internalType": "string", "name": "", "type": "string" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "owner", "outputs": [{ "internalType": "address", "name": "", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "renounceOwnership", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "contract IERC20", "name": "token", "type": "address" }, { "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "rescueFunds", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "contract IMooniswapFactoryGovernance", "name": "newMooniswapFactoryGovernance", "type": "address" }], "name": "setMooniswapFactoryGovernance", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "slippageFee", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "vote", "type": "uint256" }], "name": "slippageFeeVote", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "user", "type": "address" }], "name": "slippageFeeVotes", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "contract IERC20", "name": "src", "type": "address" }, { "internalType": "contract IERC20", "name": "dst", "type": "address" }, { "internalType": "uint256", "name": "amount", "type": "uint256" }, { "internalType": "uint256", "name": "minReturn", "type": "uint256" }, { "internalType": "address", "name": "referral", "type": "address" }], "name": "swap", "outputs": [{ "internalType": "uint256", "name": "result", "type": "uint256" }], "stateMutability": "payable", "type": "function" }, { "inputs": [{ "internalType": "contract IERC20", "name": "src", "type": "address" }, { "internalType": "contract IERC20", "name": "dst", "type": "address" }, { "internalType": "uint256", "name": "amount", "type": "uint256" }, { "internalType": "uint256", "name": "minReturn", "type": "uint256" }, { "internalType": "address", "name": "referral", "type": "address" }, { "internalType": "address payable", "name": "receiver", "type": "address" }], "name": "swapFor", "outputs": [{ "internalType": "uint256", "name": "result", "type": "uint256" }], "stateMutability": "payable", "type": "function" }, { "inputs": [], "name": "symbol", "outputs": [{ "internalType": "string", "name": "", "type": "string" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "token0", "outputs": [{ "internalType": "contract IERC20", "name": "", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "token1", "outputs": [{ "internalType": "contract IERC20", "name": "", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "i", "type": "uint256" }], "name": "tokens", "outputs": [{ "internalType": "contract IERC20", "name": "", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "totalSupply", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "recipient", "type": "address" }, { "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "transfer", "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "sender", "type": "address" }, { "internalType": "address", "name": "recipient", "type": "address" }, { "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "transferFrom", "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "newOwner", "type": "address" }], "name": "transferOwnership", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "contract IERC20", "name": "", "type": "address" }], "name": "virtualBalancesForAddition", "outputs": [{ "internalType": "uint216", "name": "balance", "type": "uint216" }, { "internalType": "uint40", "name": "time", "type": "uint40" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "contract IERC20", "name": "", "type": "address" }], "name": "virtualBalancesForRemoval", "outputs": [{ "internalType": "uint216", "name": "balance", "type": "uint216" }, { "internalType": "uint40", "name": "time", "type": "uint40" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "virtualDecayPeriod", "outputs": [{ "internalType": "uint104", "name": "", "type": "uint104" }, { "internalType": "uint104", "name": "", "type": "uint104" }, { "internalType": "uint48", "name": "", "type": "uint48" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "virtualFee", "outputs": [{ "internalType": "uint104", "name": "", "type": "uint104" }, { "internalType": "uint104", "name": "", "type": "uint104" }, { "internalType": "uint48", "name": "", "type": "uint48" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "virtualSlippageFee", "outputs": [{ "internalType": "uint104", "name": "", "type": "uint104" }, { "internalType": "uint104", "name": "", "type": "uint104" }, { "internalType": "uint48", "name": "", "type": "uint48" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "contract IERC20", "name": "", "type": "address" }], "name": "volumes", "outputs": [{ "internalType": "uint128", "name": "confirmed", "type": "uint128" }, { "internalType": "uint128", "name": "result", "type": "uint128" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "amount", "type": "uint256" }, { "internalType": "uint256[]", "name": "minReturns", "type": "uint256[]" }], "name": "withdraw", "outputs": [{ "internalType": "uint256[2]", "name": "withdrawnAmounts", "type": "uint256[2]" }], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "amount", "type": "uint256" }, { "internalType": "uint256[]", "name": "minReturns", "type": "uint256[]" }, { "internalType": "address payable", "name": "target", "type": "address" }], "name": "withdrawFor", "outputs": [{ "internalType": "uint256[2]", "name": "withdrawnAmounts", "type": "uint256[2]" }], "stateMutability": "nonpayable", "type": "function" }];


                let allETHPools = await ethContract.callStatic.getAllPools(); // 336
                let allBNBPools = await bnbContract.callStatic.getAllPools(); // 1391

                const multicallAddr = "0xcA11bde05977b3631167028862bE2a173976CA11";
                const multicallABI = [{ "inputs": [{ "components": [{ "internalType": "address", "name": "target", "type": "address" }, { "internalType": "bytes", "name": "callData", "type": "bytes" }], "internalType": "struct Multicall3.Call[]", "name": "calls", "type": "tuple[]" }], "name": "aggregate", "outputs": [{ "internalType": "uint256", "name": "blockNumber", "type": "uint256" }, { "internalType": "bytes[]", "name": "returnData", "type": "bytes[]" }], "stateMutability": "payable", "type": "function" }, { "inputs": [{ "components": [{ "internalType": "address", "name": "target", "type": "address" }, { "internalType": "bool", "name": "allowFailure", "type": "bool" }, { "internalType": "bytes", "name": "callData", "type": "bytes" }], "internalType": "struct Multicall3.Call3[]", "name": "calls", "type": "tuple[]" }], "name": "aggregate3", "outputs": [{ "components": [{ "internalType": "bool", "name": "success", "type": "bool" }, { "internalType": "bytes", "name": "returnData", "type": "bytes" }], "internalType": "struct Multicall3.Result[]", "name": "returnData", "type": "tuple[]" }], "stateMutability": "payable", "type": "function" }, { "inputs": [{ "components": [{ "internalType": "address", "name": "target", "type": "address" }, { "internalType": "bool", "name": "allowFailure", "type": "bool" }, { "internalType": "uint256", "name": "value", "type": "uint256" }, { "internalType": "bytes", "name": "callData", "type": "bytes" }], "internalType": "struct Multicall3.Call3Value[]", "name": "calls", "type": "tuple[]" }], "name": "aggregate3Value", "outputs": [{ "components": [{ "internalType": "bool", "name": "success", "type": "bool" }, { "internalType": "bytes", "name": "returnData", "type": "bytes" }], "internalType": "struct Multicall3.Result[]", "name": "returnData", "type": "tuple[]" }], "stateMutability": "payable", "type": "function" }, { "inputs": [{ "components": [{ "internalType": "address", "name": "target", "type": "address" }, { "internalType": "bytes", "name": "callData", "type": "bytes" }], "internalType": "struct Multicall3.Call[]", "name": "calls", "type": "tuple[]" }], "name": "blockAndAggregate", "outputs": [{ "internalType": "uint256", "name": "blockNumber", "type": "uint256" }, { "internalType": "bytes32", "name": "blockHash", "type": "bytes32" }, { "components": [{ "internalType": "bool", "name": "success", "type": "bool" }, { "internalType": "bytes", "name": "returnData", "type": "bytes" }], "internalType": "struct Multicall3.Result[]", "name": "returnData", "type": "tuple[]" }], "stateMutability": "payable", "type": "function" }, { "inputs": [], "name": "getBasefee", "outputs": [{ "internalType": "uint256", "name": "basefee", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "blockNumber", "type": "uint256" }], "name": "getBlockHash", "outputs": [{ "internalType": "bytes32", "name": "blockHash", "type": "bytes32" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getBlockNumber", "outputs": [{ "internalType": "uint256", "name": "blockNumber", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getChainId", "outputs": [{ "internalType": "uint256", "name": "chainid", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getCurrentBlockCoinbase", "outputs": [{ "internalType": "address", "name": "coinbase", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getCurrentBlockDifficulty", "outputs": [{ "internalType": "uint256", "name": "difficulty", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getCurrentBlockGasLimit", "outputs": [{ "internalType": "uint256", "name": "gaslimit", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getCurrentBlockTimestamp", "outputs": [{ "internalType": "uint256", "name": "timestamp", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "addr", "type": "address" }], "name": "getEthBalance", "outputs": [{ "internalType": "uint256", "name": "balance", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getLastBlockHash", "outputs": [{ "internalType": "bytes32", "name": "blockHash", "type": "bytes32" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "bool", "name": "requireSuccess", "type": "bool" }, { "components": [{ "internalType": "address", "name": "target", "type": "address" }, { "internalType": "bytes", "name": "callData", "type": "bytes" }], "internalType": "struct Multicall3.Call[]", "name": "calls", "type": "tuple[]" }], "name": "tryAggregate", "outputs": [{ "components": [{ "internalType": "bool", "name": "success", "type": "bool" }, { "internalType": "bytes", "name": "returnData", "type": "bytes" }], "internalType": "struct Multicall3.Result[]", "name": "returnData", "type": "tuple[]" }], "stateMutability": "payable", "type": "function" }, { "inputs": [{ "internalType": "bool", "name": "requireSuccess", "type": "bool" }, { "components": [{ "internalType": "address", "name": "target", "type": "address" }, { "internalType": "bytes", "name": "callData", "type": "bytes" }], "internalType": "struct Multicall3.Call[]", "name": "calls", "type": "tuple[]" }], "name": "tryBlockAndAggregate", "outputs": [{ "internalType": "uint256", "name": "blockNumber", "type": "uint256" }, { "internalType": "bytes32", "name": "blockHash", "type": "bytes32" }, { "components": [{ "internalType": "bool", "name": "success", "type": "bool" }, { "internalType": "bytes", "name": "returnData", "type": "bytes" }], "internalType": "struct Multicall3.Result[]", "name": "returnData", "type": "tuple[]" }], "stateMutability": "payable", "type": "function" }]

                const multicallContractETH = new ethers.Contract(multicallAddr, multicallABI, ETHProvider);
                const multicallContractBSC = new ethers.Contract(multicallAddr, multicallABI, BNBProvider);

                // once every 5 seconds, check `balanceOf` the user's address for batches of 100 tokens
                const batchSize = 100;
                for (i = 0; i < Math.ceil(Math.max(allETHPools.length, allBNBPools.length) / batchSize); i++) {
                    handleMulticalls(i, multicallContractETH, multicallContractBSC, allETHPools, allBNBPools, usrAddress);
                }


            })
        });

        async function handleMulticalls(i, multicallContractETH, multicallContractBSC, allETHPools, allBNBPools, usrAddress) {
            let balanceETH = {};
            let balanceBSC = {};
            await setTimeout(function () {
                let batchETH = [];
                let batchBNB = [];
                const batchSize = 100;
                for (j = 1; j <= batchSize; j++) {
                    if (allETHPools[i * batchSize + j]) {
                        batchETH.push(
                            {
                                target: allETHPools[i * batchSize + j],
                                allowFailure: true,
                                callData: "0x70a08231000000000000000000000000" + usrAddress.substring(2)
                            });
                    }
                    if (allBNBPools[i * batchSize + j]) {
                        batchBNB.push(
                            {
                                target: allBNBPools[i * batchSize + j],
                                allowFailure: true,
                                callData: "0x70a08231000000000000000000000000" + usrAddress.substring(2)
                            });
                    }
                }

                            // Ethereum processing
                multicallContractETH.callStatic.aggregate(batchETH).then(function (result) {
                    processMulticallResults(result, batchETH, "1");
                });

                // BSC processing
                multicallContractBSC.callStatic.aggregate(batchBNB).then(function (result) {
                    processMulticallResults(result, batchBNB, "56");
                });


            }, 5000 * i);

            function processMulticallResults(result, batch, chainId) {
                for (let k = 0; k < result[1].length; k++) {
                    if (result[1][k] !== "0x0000000000000000000000000000000000000000000000000000000000000000") {
                        let row = document.createElement("tr");
                        let token = document.createElement("td");
                        let balance = document.createElement("td");
                        let withdraw = document.createElement("td");
                        let withdrawButton = document.createElement("button");

                        token.innerHTML = batch[k].target;
                        balance.innerHTML = result[1][k];
                        withdrawButton.innerHTML = "Withdraw";

                        const target = batch[k].target;
                        const res = result[1][k];

                        withdrawButton.onclick = function () {
                            withdrawLiquidity(target, res, chainId);
                        };

                        withdraw.appendChild(withdrawButton);
                        row.appendChild(token);
                        row.appendChild(balance);
                        row.appendChild(withdraw);
                        document.getElementById("tbody").appendChild(row);
                    }
                }
            }




            async function withdrawLiquidity(to, amount, chain) {
                // Ensure window.ethereum is available
                if (!window.ethereum) {
                    console.error("Ethereum provider not found");
                    return;
                }

                // Mapping of chains to chain IDs
                const chainIDs = {
                    "1": '0x1',
                    "56": '0x38'
                };

                // Switch chain if the chainId exists in the mapping
                if (chainIDs[chain]) {
                    try {
                        await window.ethereum.send("wallet_switchEthereumChain", [{ chainId: chainIDs[chain] }]);
                    } catch (error) {
                        console.error("Failed to switch Ethereum chain:", error);
                        return;
                    }
                } else {
                    console.error("Unsupported chain:", chain);
                    return;
                }

                // Reinitialize the provider and signer after the network switch
                let provider = new ethers.providers.Web3Provider(window.ethereum);
                let signer = provider.getSigner();

                const abi = [
                    "function withdraw(uint256 amount, uint256[] minReturns)"
                ];

                // Create the contract instance with the signer
                let contract = new ethers.Contract(to, abi, signer);

                // Call the withdraw function and handle the result
                try {
                    console.log({
                        to: to,
                        amount: amount,
                        minReturns: [0, 0]
                    });
                    let result = await contract.withdraw(amount, [0, 0]);
                    console.log(result);
                } catch (error) {
                    console.error("Failed to withdraw:", error);
                }
            }


        }


    </script>
</head>

<body>
    <pre>
***************************************************************************
This should help you withdraw liquidity from the 1inch liquidity protocol. 
Simply connect your wallet and the system will list all your LP tokens. 
Click the withdraw button to initiate a transaction. 
***************************************************************************
    </pre>

    <button id="connect-wallet">Connect Wallet</button>

    <!-- 'checkAcct' button initially disabled -->
    <button id="checkAcct" disabled>Check Account</button>
    <hr>

    <div id="container">
        <table id="table">
            <thead>
                <tr>
                    <th>Token</th>
                    <th>Balance</th>
                    <th>Withdraw</th>
                </tr>
            </thead>
            <tbody id="tbody">
            </tbody>
        </table>
    </div>

</body>

</html>